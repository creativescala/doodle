<!doctype html>
<html lang="">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Typelevel Laika" />
    <title>Developing Doodle</title>
    
    
    <meta name="description" content="docs" />
    
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400|Source+Sans+Pro:300,400,600"
        rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Crimson+Pro:400" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="../creative-scala.css" />
    <script src="../main.js"></script>
    <script> /* for avoiding page load transitions */</script>
</head>

<body>
    <nav id="topbar"><p><a href="../canvas/examples.html">←</a></p>
<p><a href="../../">Doodle</a></p>
<p><a href="backend.html">→</a></p></nav>
    <nav id="sidebar">
        <ul class="nav-list">
          <li class="level1 nav-leaf"><a href="../">Doodle</a></li>
          <li class="level1 nav-node"><a href="../concepts/">Core Concepts</a></li>
          <li class="level2 nav-leaf"><a href="../concepts/principles.html">Principles</a></li>
          <li class="level2 nav-leaf"><a href="../concepts/algebras.html">Algebras</a></li>
          <li class="level2 nav-leaf"><a href="../concepts/drawing-picture.html">Picture and Drawing</a></li>
          <li class="level2 nav-leaf"><a href="../concepts/picture-object.html">Picture Object</a></li>
          <li class="level2 nav-leaf"><a href="../concepts/syntax.html">Syntax</a></li>
          <li class="level2 nav-leaf"><a href="../concepts/frame-canvas.html">Frame and Canvas</a></li>
          <li class="level2 nav-leaf"><a href="../concepts/effects.html">Effects</a></li>
          <li class="level1 nav-node"><a href="../pictures/">Creating Pictures</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/picture-image.html">Picture and Image</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/shape.html">Shapes</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/path.html">Paths</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/layout.html">Layout</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/style.html">Style</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/transform.html">Transforms</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/size.html">Size</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/drawing.html">Drawing to the Screen</a></li>
          <li class="level2 nav-leaf"><a href="../pictures/writing.html">Writing to a File</a></li>
          <li class="level1 nav-leaf"><a href="../core/">Core</a></li>
          <li class="level1 nav-node"><a href="../interact/">Interactivity</a></li>
          <li class="level2 nav-leaf"><a href="../interact/animation.html">Animations</a></li>
          <li class="level1 nav-node"><a href="../algebra/">Algebras</a></li>
          <li class="level2 nav-leaf"><a href="../algebra/using.html">Using Algebras</a></li>
          <li class="level2 nav-leaf"><a href="../algebra/picture.html">Picture</a></li>
          <li class="level2 nav-leaf"><a href="../algebra/algebras.html">Available Algebras</a></li>
          <li class="level1 nav-leaf"><a href="../effect/">Effects</a></li>
          <li class="level1 nav-leaf"><a href="../svg/">Doodle SVG</a></li>
          <li class="level1 nav-node"><a href="../canvas/">Doodle Canvas</a></li>
          <li class="level2 nav-leaf"><a href="../canvas/examples.html">Canvas Examples</a></li>
          <li class="level1 active nav-node"><a href="#">Developing Doodle</a></li>
          <li class="level2 nav-leaf"><a href="backend.html">Implementing a Backend</a></li>
        </ul>
    </nav>

    <div id="content">
        <main class="content">
            <h1 id="developing-doodle" class="title">Developing Doodle</h1>
            <p>This section contains notes for developers who want to work on Doodle.</p>
            
            <h2 id="implementing-syntax" class="section">Implementing Syntax</h2>
            <p>Every algebra should have associated syntax. 
            Implementing syntax is a little bit more involved than defining an algebra due to the extra work we do to make type inference work nicely.
            The goal is to build up the algebra required by a <code>Picture</code> based on the operations used.
            For example, notice the inferred type of the <code>Picture</code> below.</p>
            <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">doodle</span><span>.</span><span class="identifier">core</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">doodle</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.*</span></code></pre>
            <pre><code class="nohighlight"><span class="identifier">circle</span><span>(</span><span class="number-literal">100</span><span>).</span><span class="identifier">beside</span><span>(</span><span class="identifier">square</span><span>(</span><span class="number-literal">20</span><span>)).</span><span class="identifier">strokeColor</span><span>(</span><span class="type-name">Color</span><span>.</span><span class="identifier">red</span><span>)</span></code></pre>
            <p>This type reflects exactly the algebras used in constructing the <code>Picture</code>. 
            For users working with a single backend this is never an issue as they work from the constructors on the <code>Picture</code> object which start with all the algebras supported by the backend.
            However for users working across backends this is essential to avoid a lot of type juggling.</p>
            <p>The pattern for implementing syntax so that this work is as follows.</p>
            <ol class="arabic">
              <li>
                <p>Start with an <code>implicit class</code> extending a <code>Picture</code> with a polymorphic <code>Algebra</code> type parameter</p>
                <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">ExampleOps</span><span>[</span><span class="type-name">Alg</span><span> &lt;: </span><span class="type-name">Algebra</span><span>, </span><span class="type-name">A</span><span>](</span><span class="identifier">picture</span><span>: </span><span class="type-name">Picture</span><span>[</span><span class="type-name">Alg</span><span>, </span><span class="type-name">A</span><span>]) {</span></code></pre>
              </li>
              <li>
                <p>Methods on the <code>implicit class</code> return a <code>Picture</code> with additional algebras that the method requires</p>
                <pre><code class="nohighlight"><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">strokeColor</span><span>(</span><span class="identifier">color</span><span>: </span><span class="type-name">Color</span><span>): </span><span class="type-name">Picture</span><span>[</span><span class="type-name">Alg</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Style</span><span>] = ???
}</span></code></pre>
              </li>
            </ol>
            <p>Constructors, like <code>circle</code>, don&#39;t need to be defined on an implicit class. They don&#39;t <em>need</em> a polymorphic <code>Algebra</code> type parameter but I&#39;ve implemented them all with one just in case someone wants to fix that parameter to help with type inference. Here is an example:</p>
            <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">rectangle</span><span>[</span><span class="type-name">Alg</span><span> &lt;: </span><span class="type-name">Shape</span><span>](
    </span><span class="identifier">width</span><span>: </span><span class="type-name">Double</span><span>,
    </span><span class="identifier">height</span><span>: </span><span class="type-name">Double</span><span>
): </span><span class="type-name">Picture</span><span>[</span><span class="type-name">Alg</span><span>, </span><span class="type-name">Unit</span><span>] =
  </span><span class="keyword">new</span><span> </span><span class="type-name">Picture</span><span>[</span><span class="type-name">Alg</span><span>, </span><span class="type-name">Unit</span><span>] {
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="keyword">implicit</span><span> </span><span class="identifier">algebra</span><span>: </span><span class="type-name">Alg</span><span>): </span><span class="identifier">algebra</span><span>.</span><span class="type-name">Drawing</span><span>[</span><span class="type-name">Unit</span><span>] =
      </span><span class="identifier">algebra</span><span>.</span><span class="identifier">rectangle</span><span>(</span><span class="identifier">width</span><span>, </span><span class="identifier">height</span><span>)
  }</span></code></pre>
            <p>Binary operations, such as <code>on</code>, require <em>two</em> polymorphic <code>Algebra</code> type parameters.
            Here&#39;s the implementation of <code>on</code> showing this (<code>Alg</code> and <code>Alg2</code>).</p>
            <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">LayoutPictureOps</span><span>[</span><span class="type-name">Alg</span><span> &lt;: </span><span class="type-name">Algebra</span><span>, </span><span class="type-name">A</span><span>](
    </span><span class="identifier">picture</span><span>: </span><span class="type-name">Picture</span><span>[</span><span class="type-name">Alg</span><span>, </span><span class="type-name">A</span><span>]
) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">on</span><span>[</span><span class="type-name">Alg2</span><span> &lt;: </span><span class="type-name">Algebra</span><span>](
      </span><span class="identifier">that</span><span>: </span><span class="type-name">Picture</span><span>[</span><span class="type-name">Alg2</span><span>, </span><span class="type-name">A</span><span>]
  )(</span><span class="keyword">implicit</span><span> </span><span class="identifier">s</span><span>: </span><span class="type-name">Semigroup</span><span>[</span><span class="type-name">A</span><span>]): </span><span class="type-name">Picture</span><span>[</span><span class="type-name">Alg</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Alg2</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Layout</span><span>, </span><span class="type-name">A</span><span>] =
    </span><span class="keyword">new</span><span> </span><span class="type-name">Picture</span><span>[</span><span class="type-name">Alg</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Alg2</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Layout</span><span>, </span><span class="type-name">A</span><span>] {
      </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="keyword">implicit</span><span>
          </span><span class="identifier">algebra</span><span>: </span><span class="type-name">Alg</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Alg2</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">Layout</span><span>
      ): </span><span class="identifier">algebra</span><span>.</span><span class="type-name">Drawing</span><span>[</span><span class="type-name">A</span><span>] =
        </span><span class="identifier">algebra</span><span>.</span><span class="identifier">on</span><span>(</span><span class="identifier">picture</span><span>(</span><span class="identifier">algebra</span><span>), </span><span class="identifier">that</span><span>(</span><span class="identifier">algebra</span><span>))
    }
}</span></code></pre>
            <p class="nextPage"><a href="backend.html">Implementing a Backend→</a></p>
        </main>
        <footer>Creative Scala is copyright Noel Welsh</footer>
    </div>

    </div>
</body>

</html>
